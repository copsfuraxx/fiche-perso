name: Build and FTP Deploy on Tag

on:
  push:
    tags:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Build project
      run: |
        npm install
        npm run build

    - name: Upload files via FTP (Linux command line)
      env:
        FTP_HOST: ${{ secrets.FTP_HOST }}
        FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      run: |
        cd ./dist
        ftp $FTP_HOST <<EOF
        user $FTP_USERNAME
        $FTP_PASSWORD
        cd ./www/fichePerso
        mput *
        bye
        EOF
